# -- Default number of instances to start 
replicaCount: 1
name: federated-catalog
# -- Ovverwrites application name
# nameOverride: ""

image:
  repository: ds4h-registry:5432
  name: edc-federated-catalog
  tag: latest
  # -- Image sha, usually generated by the CI
  # Uses image.tag if empty
  sha: ""
  pullPolicy: Always
  # -- Image pull secret when internal image is used
  pullSecrets:

## Use configMap or secretRef for environment variables
# useConfigMap: false
# configMapName: my-configmap
# useSecretRef: false
# secretRefName: my-secret

podAnnotations: {}

extraVars:
  - name: HEALTH_ENDPOINT_PATH
    value: "/edc/cp/base/api/check/health"

  - name: WEB_HTTP_CATALOG_PATH
    value: "/api/catalog"

  - name: WEB_HTTP_CATALOG_PORT
    value: "9195"

  - name: WEB_HTTP_PATH
    value: "/api"

  - name: WEB_HTTP_PORT
    value: "8080"

  - name: EDC_CATALOG_CACHE_EXECUTION_DELAY_SECONDS
    value: "5"

  - name: EDC_CATALOG_CACHE_EXECUTION_PERIOD_SECONDS
    value: "5"

  - name: EDC_CATALOG_CACHE_PARTITION_NUM_CRAWLERS
    value: "1"
  
  #The origin maps to the domain from which the requests are allowed, here it is dashboard domain.
  #TODO: it changes when deployed on production environment with correct domain name
  - name: EDC_WEB_REST_CORS_ORIGINS
    value: "http://dataspace4health.local"
  
  - name: EDC_WEB_REST_CORS_ENABLED
    value: "true"
  
  - name: EDC_WEB_REST_CORS_HEADERS
    value: "Authorization, Content-Type, Origin, Accept, x-api-key"
  
  - name: EDC_WEB_REST_CORS_METHODS
    value: "GET,POST,PUT,DELETE,OPTIONS"      
  
  - name: LOG_LEVEL
    value: "debug"


## Configure pod autoscaling
## TODO change autoscaling based on participants number
autoscaling:
  enabled: false
  minReplicas: 2
  maxReplicas: 3
  # -- CPU target for autoscaling trigger
  targetCPUUtilizationPercentage: 70
  # -- Memory target for autoscaling trigger
  targetMemoryUtilizationPercentage: 70

## Prometheus Exporter/Metrics enable/disable and Port for prometheus metrics
metrics:
  enabled: false
  port: 2112

log:
  level: "debug"
  encoding: json    

##
## Kubernetes [SecurityContext](https://kubernetes.io/docs/tasks/configure-pod-container/security-context/) object.
##

security:
  # -- by default, apps run as non-root
  runAsNonRoot: false
  # -- User used by the apps
  runAsUid: 0
  # -- Group used by the apps
  runAsGid: 0
##
##
service:
  port: 9195

#for now the edc federated catalog will be refered as edc-federated-catalog as we have another federated-catalog repo.
#later we can change this to just federated-catalog
config:
  environment: development
  HEALTH_ENDPOINT_PATH: edc/cp/base/api/check/health
  api:
    basePath: /api
  http:
    host: ""
    port: 9195
    timeout:
      idle: 120s
      read: 10s
      write: 10s

postgresql:
  enabled: true
  image:
    registry: bitnamilegacy
    repository: postgresql
    tag: 16.2.0-debian-12-r8
  auth:
    postgresPassword: "xfsc4Ntt!"
    username: "postgres"
    password: "xfsc4Ntt!"
    database: postgres
  primary:
    persistence:
      enabled: true
      size: 5Gi
      path: "/mnt/data"

ingress:
  enabled: true
  hosts:
    - host: dataspace4health.local
      paths:
      - path: /edc-fc
        port: 9195
        pathType: Prefix
  tls:
    - secretName: dataspace4health.local
      hosts:
        - dataspace4health.local
  rewriteTargets:
    - regex: ^/edc-fc/(.*)
      replacement: /$1

## the health check end point is provided by the observability module of EDC
readinessProbe:
  enabled: true
  path: /api/check/health
  http:
    port: 8080

secretEnv:

